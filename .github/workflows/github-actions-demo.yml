name: GitHub Actions Demo
on: [workflow_dispatch]
jobs:
  Test-Aligo:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      
      - run: |
          wget https://github.com/fatedier/frp/releases/download/v0.42.0/frp_0.42.0_linux_amd64.tar.gz
          tar xf frp_0.42.0_linux_amd64.tar.gz
          cp frp_0.42.0_linux_amd64/frpc /usr/bin/
          cp frp_0.42.0_linux_amd64/systemd/frpc.service /etc/systemd/system/
          cat > /etc/frp/frpc.ini <<EOF
            [common]
            server_addr = 112.124.20.91
            server_port = 7000

            [ssh]
            type = tcp
            local_ip = 127.0.0.1
            local_port = 22
            remote_port = 7103
          EOF
          systemctl daemon-reload
          systemctl start frpc.service
          
      - name: Don't kill instace
        if: ${{ failure() }}
        run: sleep 1h # Prevent to killing instance after failure
